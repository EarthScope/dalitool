<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>libdali: connection.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
<link href="../../tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="../../index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="../../annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>connection.c File Reference</h1><code>#include &lt;stdlib.h&gt;</code><br>
<code>#include &lt;stdio.h&gt;</code><br>
<code>#include &lt;errno.h&gt;</code><br>
<code>#include &lt;string.h&gt;</code><br>
<code>#include &quot;<a class="el" href="../../d3/d41/libdali_8h.html">libdali.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="../../d2/de2/portable_8h.html">portable.h</a>&quot;</code><br>

<p>
<div class="dynheader">
Include dependency graph for connection.c:</div>
<div class="dynsection">
<p><center><img src="../../db/d99/connection_8c__incl.png" border="0" usemap="#connection.c_map" alt=""></center>
<map name="connection.c_map">
<area shape="rect" href="../../d3/d41/libdali_8h.html" title="libdali.h" alt="" coords="360,80,429,107"><area shape="rect" href="../../d2/de2/portable_8h.html" title="portable.h" alt="" coords="389,155,472,182"></map>
</div>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="../../d9/d9a/struct_d_l_c_p.html">DLCP</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d5f/connection_8c.html#663e07d45c7acd0377b5f1f4d930b5a7">dl_newdlcp</a> (char *address, char *progname)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Create a new DataLink Connection Parameter (<a class="el" href="../../d9/d9a/struct_d_l_c_p.html">DLCP</a>) structure.  <a href="#663e07d45c7acd0377b5f1f4d930b5a7"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d5f/connection_8c.html#7603e72f54c34879f86c319239a50e52">dl_freedlcp</a> (<a class="el" href="../../d9/d9a/struct_d_l_c_p.html">DLCP</a> *dlconn)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Free a DataLink Connection Parameter (<a class="el" href="../../d9/d9a/struct_d_l_c_p.html">DLCP</a>) structure.  <a href="#7603e72f54c34879f86c319239a50e52"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d5f/connection_8c.html#38b35bee3faee3f24543feda8ecc3a6c">dl_exchangeIDs</a> (<a class="el" href="../../d9/d9a/struct_d_l_c_p.html">DLCP</a> *dlconn, int parseresp)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Send the ID command to the DataLink server and parse response.  <a href="#38b35bee3faee3f24543feda8ecc3a6c"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int64_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d5f/connection_8c.html#823f483f8492e0317a5221c3f02b13d0">dl_position</a> (<a class="el" href="../../d9/d9a/struct_d_l_c_p.html">DLCP</a> *dlconn, int64_t pktid, <a class="el" href="../../d3/d41/libdali_8h.html#d46ecd16ed2b512a60d5f948fa15a31f">dltime_t</a> pkttime)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Position the client read position.  <a href="#823f483f8492e0317a5221c3f02b13d0"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int64_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d5f/connection_8c.html#b8bc14b495d971ea3b119bfc3796b00f">dl_position_after</a> (<a class="el" href="../../d9/d9a/struct_d_l_c_p.html">DLCP</a> *dlconn, <a class="el" href="../../d3/d41/libdali_8h.html#d46ecd16ed2b512a60d5f948fa15a31f">dltime_t</a> datatime)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Position the client read position based on data time.  <a href="#b8bc14b495d971ea3b119bfc3796b00f"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int64_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d5f/connection_8c.html#0a7501ffdf01f73f8e5b1c1b9ca29843">dl_match</a> (<a class="el" href="../../d9/d9a/struct_d_l_c_p.html">DLCP</a> *dlconn, char *matchpattern)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set the packet match parameters for a connection.  <a href="#0a7501ffdf01f73f8e5b1c1b9ca29843"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int64_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d5f/connection_8c.html#ffcdbcae2611a8c6208243bc2a418149">dl_reject</a> (<a class="el" href="../../d9/d9a/struct_d_l_c_p.html">DLCP</a> *dlconn, char *rejectpattern)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set the packet reject parameters for a connection.  <a href="#ffcdbcae2611a8c6208243bc2a418149"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int64_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d5f/connection_8c.html#6a21194a1a308eb91db0d32bced621f8">dl_write</a> (<a class="el" href="../../d9/d9a/struct_d_l_c_p.html">DLCP</a> *dlconn, void *packet, int packetlen, char *streamid, <a class="el" href="../../d3/d41/libdali_8h.html#d46ecd16ed2b512a60d5f948fa15a31f">dltime_t</a> datastart, <a class="el" href="../../d3/d41/libdali_8h.html#d46ecd16ed2b512a60d5f948fa15a31f">dltime_t</a> dataend, int ack)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Send a packet to the DataLink server.  <a href="#6a21194a1a308eb91db0d32bced621f8"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d5f/connection_8c.html#9a49f3842de1a14030b20e665bfcbf31">dl_read</a> (<a class="el" href="../../d9/d9a/struct_d_l_c_p.html">DLCP</a> *dlconn, int64_t pktid, <a class="el" href="../../d1/da3/struct_d_l_packet.html">DLPacket</a> *packet, void *packetdata, size_t maxdatasize)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Request a packet from the DataLink server.  <a href="#9a49f3842de1a14030b20e665bfcbf31"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d5f/connection_8c.html#812ede0c3d5e15ab118c489087b01260">dl_getinfo</a> (<a class="el" href="../../d9/d9a/struct_d_l_c_p.html">DLCP</a> *dlconn, const char *infotype, char *infomatch, char **infodata, size_t maxinfosize)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Request information from the DataLink server.  <a href="#812ede0c3d5e15ab118c489087b01260"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d5f/connection_8c.html#ccca46f231c23fd495bb6d5725e97957">dl_collect</a> (<a class="el" href="../../d9/d9a/struct_d_l_c_p.html">DLCP</a> *dlconn, <a class="el" href="../../d1/da3/struct_d_l_packet.html">DLPacket</a> *packet, void *packetdata, size_t maxdatasize, int8_t endflag)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Collect packets streaming from the DataLink server.  <a href="#ccca46f231c23fd495bb6d5725e97957"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d5f/connection_8c.html#a1343fa010d7cce001da5fb4a231dcd7">dl_collect_nb</a> (<a class="el" href="../../d9/d9a/struct_d_l_c_p.html">DLCP</a> *dlconn, <a class="el" href="../../d1/da3/struct_d_l_packet.html">DLPacket</a> *packet, void *packetdata, size_t maxdatasize, int8_t endflag)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Collect packets streaming from the DataLink server without blocking.  <a href="#a1343fa010d7cce001da5fb4a231dcd7"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d5f/connection_8c.html#28610d15c30459cb171beaa6954798a4">dl_handlereply</a> (<a class="el" href="../../d9/d9a/struct_d_l_c_p.html">DLCP</a> *dlconn, void *buffer, int buflen, int64_t *value)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Handle the server reply to a command.  <a href="#28610d15c30459cb171beaa6954798a4"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d5/d5f/connection_8c.html#a357699d12a48e074de595f30e3565fb">dl_terminate</a> (<a class="el" href="../../d9/d9a/struct_d_l_c_p.html">DLCP</a> *dlconn)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Set the terminate parameter of a DataLink connection.  <a href="#a357699d12a48e074de595f30e3565fb"></a><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Routines for managing a connection with a DataLink server.<p>
<dl class="author" compact><dt><b>Author:</b></dt><dd>Chad Trabant, IRIS Data Management Center</dd></dl>
modified: 2008.256 <hr><h2>Function Documentation</h2>
<a class="anchor" name="ccca46f231c23fd495bb6d5725e97957"></a><!-- doxytag: member="connection.c::dl_collect" ref="ccca46f231c23fd495bb6d5725e97957" args="(DLCP *dlconn, DLPacket *packet, void *packetdata, size_t maxdatasize, int8_t endflag)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dl_collect           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d9/d9a/struct_d_l_c_p.html">DLCP</a> *&nbsp;</td>
          <td class="paramname"> <em>dlconn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d1/da3/struct_d_l_packet.html">DLPacket</a> *&nbsp;</td>
          <td class="paramname"> <em>packet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>packetdata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>maxdatasize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int8_t&nbsp;</td>
          <td class="paramname"> <em>endflag</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Collect packets streaming from the DataLink server. 
<p>
Collect packets streaming from the DataLink server. If the connection is not already in streaming mode the STREAM command will first be sent. This routine will block until a packet is received sending keepalive packets to the server based on the <a class="el" href="../../d9/d9a/struct_d_l_c_p.html#11b0393bfa624f25fc19dfc0b7005e11">DLCP.keepalive</a> parameter.<p>
Designed to run in a tight loop at the heart of a client program, this function will return every time a packet is received. On successfully receiving a packet <em>dlpack</em> will be populated and the packet data will be copied into <em>packetdata</em>.<p>
If the endflag is true the ENDSTREAM command is sent which instructs the server to stop streaming packets; a client must continue collecting packets until DLENDED is returned in order to get any packets that were in-the-air when ENDSTREAM was requested. The stream ending sequence must be completed if the connection is to be used after streaming mode.<p>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>DLPACKET</em>&nbsp;</td><td>when a packet is received. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>DLENDED</em>&nbsp;</td><td>when the stream ending sequence was completed or the connection was shut down. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>DLERROR</em>&nbsp;</td><td>when an error occurred. </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="a1343fa010d7cce001da5fb4a231dcd7"></a><!-- doxytag: member="connection.c::dl_collect_nb" ref="a1343fa010d7cce001da5fb4a231dcd7" args="(DLCP *dlconn, DLPacket *packet, void *packetdata, size_t maxdatasize, int8_t endflag)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dl_collect_nb           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d9/d9a/struct_d_l_c_p.html">DLCP</a> *&nbsp;</td>
          <td class="paramname"> <em>dlconn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d1/da3/struct_d_l_packet.html">DLPacket</a> *&nbsp;</td>
          <td class="paramname"> <em>packet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>packetdata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>maxdatasize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int8_t&nbsp;</td>
          <td class="paramname"> <em>endflag</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Collect packets streaming from the DataLink server without blocking. 
<p>
Collect packets streaming from the DataLink server. If the connection is not already in streaming mode the STREAM command will first be sent. This routine is a non-blocking version of <a class="el" href="../../d5/d5f/connection_8c.html#ccca46f231c23fd495bb6d5725e97957" title="Collect packets streaming from the DataLink server.">dl_collect()</a> and will return quickly whether data is received or not. Keep alive packets are sent to the server based on the <a class="el" href="../../d9/d9a/struct_d_l_c_p.html#11b0393bfa624f25fc19dfc0b7005e11">DLCP.keepalive</a> parameter.<p>
Designed to run in a tight loop at the heart of a client program, this function will return every time a packet is received. On successfully receiving a packet <em>dlpack</em> will be populated and the packet data will be copied into <em>packetdata</em>.<p>
If the <em>endflag</em> is true the ENDSTREAM command is sent which instructs the server to stop streaming packets; a client must continue collecting packets until DLENDED is returned in order to get any packets that were in-the-air when ENDSTREAM was requested. The stream ending sequence must be completed if the connection is to be used after streaming mode.<p>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>DLPACKET</em>&nbsp;</td><td>A packet is received. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>DLNOPACKET</em>&nbsp;</td><td>No packet is received. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>DLENDED</em>&nbsp;</td><td>when the stream ending sequence was completed or the connection was shut down. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>DLERROR</em>&nbsp;</td><td>when an error occurred. </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="38b35bee3faee3f24543feda8ecc3a6c"></a><!-- doxytag: member="connection.c::dl_exchangeIDs" ref="38b35bee3faee3f24543feda8ecc3a6c" args="(DLCP *dlconn, int parseresp)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dl_exchangeIDs           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d9/d9a/struct_d_l_c_p.html">DLCP</a> *&nbsp;</td>
          <td class="paramname"> <em>dlconn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>parseresp</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Send the ID command to the DataLink server and parse response. 
<p>
Send the ID command including the client ID and optionally parse the capability flags from the server response. This routine is always called when a connection is first made using <a class="el" href="../../d3/d41/libdali_8h.html#8c10ccc5784a65e6efa88e9e80746a82" title="Connect to a DataLink server.">dl_connect()</a> and shouldn't normally need to be called again.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dlconn</em>&nbsp;</td><td>DataLink Connection Parameters </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>parseresp</em>&nbsp;</td><td>Flag to control parsing of server response.</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>-1 on errors, 0 on success. </dd></dl>

</div>
</div><p>
<a class="anchor" name="7603e72f54c34879f86c319239a50e52"></a><!-- doxytag: member="connection.c::dl_freedlcp" ref="7603e72f54c34879f86c319239a50e52" args="(DLCP *dlconn)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dl_freedlcp           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d9/d9a/struct_d_l_c_p.html">DLCP</a> *&nbsp;</td>
          <td class="paramname"> <em>dlconn</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Free a DataLink Connection Parameter (<a class="el" href="../../d9/d9a/struct_d_l_c_p.html">DLCP</a>) structure. 
<p>
Free all memory associated with a <a class="el" href="../../d9/d9a/struct_d_l_c_p.html">DLCP</a> struct.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dlconn</em>&nbsp;</td><td><a class="el" href="../../d9/d9a/struct_d_l_c_p.html">DLCP</a> to free </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="812ede0c3d5e15ab118c489087b01260"></a><!-- doxytag: member="connection.c::dl_getinfo" ref="812ede0c3d5e15ab118c489087b01260" args="(DLCP *dlconn, const char *infotype, char *infomatch, char **infodata, size_t maxinfosize)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dl_getinfo           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d9/d9a/struct_d_l_c_p.html">DLCP</a> *&nbsp;</td>
          <td class="paramname"> <em>dlconn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>infotype</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>infomatch</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&nbsp;</td>
          <td class="paramname"> <em>infodata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>maxinfosize</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Request information from the DataLink server. 
<p>
Request and receive information from the server using the DataLink INFO command. The INFO response is placed in the supplied <em>infodata</em> buffer. All DataLink INFO responses are returned as XML.<p>
If <em>maxinfosize</em> argument is 0 memory will be allocated as needed for the INFO data result and the infodata pointer will be set to this new buffer; it is up to the caller to free this memory. If an infomatch string is supplied it will be appended to the INFO request sent to the server.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dlconn</em>&nbsp;</td><td>DataLink Connection Parameters </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>infotype</em>&nbsp;</td><td>The INFO type to request </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>infomatch</em>&nbsp;</td><td>An optional match pattern </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>infodata</em>&nbsp;</td><td>Buffer to place the INFO response into </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>maxinfosize</em>&nbsp;</td><td>Maximum number of bytes to write to <em>infodata</em> buffer</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>The length of the INFO response in bytes on success and -1 on error. </dd></dl>

</div>
</div><p>
<a class="anchor" name="28610d15c30459cb171beaa6954798a4"></a><!-- doxytag: member="connection.c::dl_handlereply" ref="28610d15c30459cb171beaa6954798a4" args="(DLCP *dlconn, void *buffer, int buflen, int64_t *value)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dl_handlereply           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d9/d9a/struct_d_l_c_p.html">DLCP</a> *&nbsp;</td>
          <td class="paramname"> <em>dlconn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>buflen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64_t *&nbsp;</td>
          <td class="paramname"> <em>value</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Handle the server reply to a command. 
<p>
Handle the server reply to a command. This routine is used by other library routines to process replies from the server.<p>
Server replies are of the form:<p>
"OK|ERROR value size"<p>
followed by an optional server message of size bytes. If size is greater than zero it will be read from the connection and placed into <em>buffer</em>. The server message, if included, will always be a NULL-terminated string.<p>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>Error </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>"OK" received </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>1</em>&nbsp;</td><td>"ERROR" received </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="0a7501ffdf01f73f8e5b1c1b9ca29843"></a><!-- doxytag: member="connection.c::dl_match" ref="0a7501ffdf01f73f8e5b1c1b9ca29843" args="(DLCP *dlconn, char *matchpattern)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int64_t dl_match           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d9/d9a/struct_d_l_c_p.html">DLCP</a> *&nbsp;</td>
          <td class="paramname"> <em>dlconn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>matchpattern</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Set the packet match parameters for a connection. 
<p>
Send new match pattern to server or reset matching. If <em>matchpattern</em> is NULL a zero length pattern command is sent to the server which resets the client matching setting.<p>
The packet match pattern limits which packets are sent to the client in streaming mode, this is the mode used for <a class="el" href="../../d5/d5f/connection_8c.html#ccca46f231c23fd495bb6d5725e97957" title="Collect packets streaming from the DataLink server.">dl_collect()</a> and <a class="el" href="../../d5/d5f/connection_8c.html#a1343fa010d7cce001da5fb4a231dcd7" title="Collect packets streaming from the DataLink server without blocking.">dl_collect_nb()</a> requests.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dlconn</em>&nbsp;</td><td>DataLink Connection Parameters </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>matchpattern</em>&nbsp;</td><td>Match regular expression</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>the count of currently matched streams on success and -1 on error. </dd></dl>

</div>
</div><p>
<a class="anchor" name="663e07d45c7acd0377b5f1f4d930b5a7"></a><!-- doxytag: member="connection.c::dl_newdlcp" ref="663e07d45c7acd0377b5f1f4d930b5a7" args="(char *address, char *progname)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="../../d9/d9a/struct_d_l_c_p.html">DLCP</a>* dl_newdlcp           </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>address</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>progname</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Create a new DataLink Connection Parameter (<a class="el" href="../../d9/d9a/struct_d_l_c_p.html">DLCP</a>) structure. 
<p>
Allocate, initialze and return a pointer to a new <a class="el" href="../../d9/d9a/struct_d_l_c_p.html">DLCP</a> struct.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>address</em>&nbsp;</td><td>Address of DataLink server in "host:port" format </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>progname</em>&nbsp;</td><td>Name of program, usually argv[0]</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>allocated <a class="el" href="../../d9/d9a/struct_d_l_c_p.html">DLCP</a> struct on success, NULL on error. </dd></dl>

</div>
</div><p>
<a class="anchor" name="823f483f8492e0317a5221c3f02b13d0"></a><!-- doxytag: member="connection.c::dl_position" ref="823f483f8492e0317a5221c3f02b13d0" args="(DLCP *dlconn, int64_t pktid, dltime_t pkttime)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int64_t dl_position           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d9/d9a/struct_d_l_c_p.html">DLCP</a> *&nbsp;</td>
          <td class="paramname"> <em>dlconn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64_t&nbsp;</td>
          <td class="paramname"> <em>pktid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d3/d41/libdali_8h.html#d46ecd16ed2b512a60d5f948fa15a31f">dltime_t</a>&nbsp;</td>
          <td class="paramname"> <em>pkttime</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Position the client read position. 
<p>
Set the client read position to a specified packet ID and packet time. A packet ID and time together uniquely identify a packet in a DataLink server. The packet time must match the packet ID current in the server's buffer or the positioning request will fail.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dlconn</em>&nbsp;</td><td>DataLink Connection Parameters </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pktid</em>&nbsp;</td><td>Packet ID to set position to </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pkttime</em>&nbsp;</td><td>Packet time cooresponding to <em>pktid</em> </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>A positive packet ID on success and -1 on error. </dd></dl>

</div>
</div><p>
<a class="anchor" name="b8bc14b495d971ea3b119bfc3796b00f"></a><!-- doxytag: member="connection.c::dl_position_after" ref="b8bc14b495d971ea3b119bfc3796b00f" args="(DLCP *dlconn, dltime_t datatime)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int64_t dl_position_after           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d9/d9a/struct_d_l_c_p.html">DLCP</a> *&nbsp;</td>
          <td class="paramname"> <em>dlconn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d3/d41/libdali_8h.html#d46ecd16ed2b512a60d5f948fa15a31f">dltime_t</a>&nbsp;</td>
          <td class="paramname"> <em>datatime</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Position the client read position based on data time. 
<p>
Set the client read position to the first packet with a data end time after a reference <em>datatime</em>. The reference time must be specified as a dltime_t value, see <a class="el" href="../../d3/d41/libdali_8h.html#2deac0dfe42843e14d9e79e537061b90" title="Convert specified time values to a dltime_t value.">dl_time2dltime()</a> and friends to generate these time values.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dlconn</em>&nbsp;</td><td>DataLink Connection Parameters </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>datatime</em>&nbsp;</td><td>Reference data time as a dltime_t value</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>A positive packet ID on success and -1 on error. </dd></dl>

</div>
</div><p>
<a class="anchor" name="9a49f3842de1a14030b20e665bfcbf31"></a><!-- doxytag: member="connection.c::dl_read" ref="9a49f3842de1a14030b20e665bfcbf31" args="(DLCP *dlconn, int64_t pktid, DLPacket *packet, void *packetdata, size_t maxdatasize)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dl_read           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d9/d9a/struct_d_l_c_p.html">DLCP</a> *&nbsp;</td>
          <td class="paramname"> <em>dlconn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int64_t&nbsp;</td>
          <td class="paramname"> <em>pktid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d1/da3/struct_d_l_packet.html">DLPacket</a> *&nbsp;</td>
          <td class="paramname"> <em>packet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>packetdata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>maxdatasize</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Request a packet from the DataLink server. 
<p>
Request a specific packet from the server.<p>
A maximum of <em>maxdatasize</em> will be written to <em>packetdata</em>. If the packet data is larger than this maximum size an error will be logged and 0 will be returned; the packet data will be recv'd and discarded in order to leave the connection in a usable state.<p>
If this routine returns -1 the connection should be considered to be in a bad state and should be shut down.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dlconn</em>&nbsp;</td><td>DataLink Connection Parameters </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>pktid</em>&nbsp;</td><td>Packet ID to request </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>packet</em>&nbsp;</td><td>Pointer to a <a class="el" href="../../d1/da3/struct_d_l_packet.html">DLPacket</a> struct for the received packet header information </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>packetdata</em>&nbsp;</td><td>Pointer to a buffer for received packet data </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>maxdatasize</em>&nbsp;</td><td>Maximum data size to write to <em>packetdata</em> </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Number of bytes of packet data received on success and -1 on error. </dd></dl>

</div>
</div><p>
<a class="anchor" name="ffcdbcae2611a8c6208243bc2a418149"></a><!-- doxytag: member="connection.c::dl_reject" ref="ffcdbcae2611a8c6208243bc2a418149" args="(DLCP *dlconn, char *rejectpattern)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int64_t dl_reject           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d9/d9a/struct_d_l_c_p.html">DLCP</a> *&nbsp;</td>
          <td class="paramname"> <em>dlconn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>rejectpattern</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Set the packet reject parameters for a connection. 
<p>
Send new reject pattern to server or reset rejecting. If <em>rejectpattern</em> is NULL a zero length pattern command is sent to the server which resets the client rejecting setting.<p>
The packet reject pattern limits which packets are sent to the client in streaming mode, this is the mode used for <a class="el" href="../../d5/d5f/connection_8c.html#ccca46f231c23fd495bb6d5725e97957" title="Collect packets streaming from the DataLink server.">dl_collect()</a> and <a class="el" href="../../d5/d5f/connection_8c.html#a1343fa010d7cce001da5fb4a231dcd7" title="Collect packets streaming from the DataLink server without blocking.">dl_collect_nb()</a> requests.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dlconn</em>&nbsp;</td><td>DataLink Connection Parameters </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>rejectpattern</em>&nbsp;</td><td>Reject regular expression</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>the count of currently rejected streams on success and -1 on error. </dd></dl>

</div>
</div><p>
<a class="anchor" name="a357699d12a48e074de595f30e3565fb"></a><!-- doxytag: member="connection.c::dl_terminate" ref="a357699d12a48e074de595f30e3565fb" args="(DLCP *dlconn)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dl_terminate           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d9/d9a/struct_d_l_c_p.html">DLCP</a> *&nbsp;</td>
          <td class="paramname"> <em>dlconn</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Set the terminate parameter of a DataLink connection. 
<p>
Set the terminate parameter/flag in the <em><a class="el" href="../../d9/d9a/struct_d_l_c_p.html">DLCP</a></em> and log a diagnostic message indicating that the connection is terminating. Some of the library routines watch the terminate parameter as an indication that the client program is requesting a shut down. This routine is typically used in a signal handler. 
</div>
</div><p>
<a class="anchor" name="6a21194a1a308eb91db0d32bced621f8"></a><!-- doxytag: member="connection.c::dl_write" ref="6a21194a1a308eb91db0d32bced621f8" args="(DLCP *dlconn, void *packet, int packetlen, char *streamid, dltime_t datastart, dltime_t dataend, int ack)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int64_t dl_write           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d9/d9a/struct_d_l_c_p.html">DLCP</a> *&nbsp;</td>
          <td class="paramname"> <em>dlconn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>packet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>packetlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>streamid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d3/d41/libdali_8h.html#d46ecd16ed2b512a60d5f948fa15a31f">dltime_t</a>&nbsp;</td>
          <td class="paramname"> <em>datastart</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="../../d3/d41/libdali_8h.html#d46ecd16ed2b512a60d5f948fa15a31f">dltime_t</a>&nbsp;</td>
          <td class="paramname"> <em>dataend</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>ack</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Send a packet to the DataLink server. 
<p>
Send a packet to the server and optionally request and process an acknowledgement from the server. An appropriate DataLink packet header is created from the supplied parameters and sent with the packet data.<p>
When an acknowledgement from the server has been requested this routine will receive the response from the server and parse it, a successful acknowledgement is indicated by the return value.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dlconn</em>&nbsp;</td><td>DataLink Connection Parameters </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>packet</em>&nbsp;</td><td>Packet data buffer to send </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>packetlen</em>&nbsp;</td><td>Length of data in bytes to send from <em>packet</em> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>streamid</em>&nbsp;</td><td>Stream ID of packet </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>datastart</em>&nbsp;</td><td>Data start time for packet </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>dataend</em>&nbsp;</td><td>Data end time for packet </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>ack</em>&nbsp;</td><td>Acknowledgement flag, if true request acknowledgement</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>-1 on error and 0 on success when no acknowledgement is requested and a positive packet ID on success when acknowledgement is requested. </dd></dl>

</div>
</div><p>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Fri Sep 12 15:38:53 2008 for libdali by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
