<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>libdali: network.c File Reference</title>
<link href="../../doxygen.css" rel="stylesheet" type="text/css">
<link href="../../tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="../../index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="../../annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>network.c File Reference</h1><code>#include &lt;stdio.h&gt;</code><br>
<code>#include &lt;stdlib.h&gt;</code><br>
<code>#include &lt;string.h&gt;</code><br>
<code>#include &quot;<a class="el" href="../../d3/d41/libdali_8h.html">libdali.h</a>&quot;</code><br>

<p>
<div class="dynheader">
Include dependency graph for network.c:</div>
<div class="dynsection">
<p><center><img src="../../d3/de6/network_8c__incl.png" border="0" usemap="#network.c_map" alt=""></center>
<map name="network.c_map">
<area shape="rect" href="../../d3/d41/libdali_8h.html" title="libdali.h" alt="" coords="270,80,339,107"><area shape="rect" href="../../d2/de2/portable_8h.html" title="portable.h" alt="" coords="263,155,346,182"></map>
</div>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/d6e/network_8c.html#8c10ccc5784a65e6efa88e9e80746a82">dl_connect</a> (<a class="el" href="../../d9/d9a/struct_d_l_c_p.html">DLCP</a> *dlconn)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Connect to a DataLink server.  <a href="#8c10ccc5784a65e6efa88e9e80746a82"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/d6e/network_8c.html#5b31313fabb3c66918276e87695dec16">dl_disconnect</a> (<a class="el" href="../../d9/d9a/struct_d_l_c_p.html">DLCP</a> *dlconn)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Disconnect a DataLink connection.  <a href="#5b31313fabb3c66918276e87695dec16"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/d6e/network_8c.html#3bdb00c1cd5ecdbd464ee9012fa80f6d">dl_senddata</a> (<a class="el" href="../../d9/d9a/struct_d_l_c_p.html">DLCP</a> *dlconn, void *buffer, size_t sendlen)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Send arbitrary data to a DataLink server.  <a href="#3bdb00c1cd5ecdbd464ee9012fa80f6d"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/d6e/network_8c.html#15eee68e254a3fc494acfd51ae623c70">dl_sendpacket</a> (<a class="el" href="../../d9/d9a/struct_d_l_c_p.html">DLCP</a> *dlconn, void *headerbuf, size_t headerlen, void *databuf, size_t datalen, void *respbuf, int resplen)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Create and send a DataLink packet.  <a href="#15eee68e254a3fc494acfd51ae623c70"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/d6e/network_8c.html#a38aa90808beee57585044aab4c8e817">dl_recvdata</a> (<a class="el" href="../../d9/d9a/struct_d_l_c_p.html">DLCP</a> *dlconn, void *buffer, size_t readlen, uint8_t blockflag)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Receive arbitrary data from a DataLink server.  <a href="#a38aa90808beee57585044aab4c8e817"></a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d6/d6e/network_8c.html#9965316177619f3588cdd22b78899bd1">dl_recvheader</a> (<a class="el" href="../../d9/d9a/struct_d_l_c_p.html">DLCP</a> *dlconn, void *buffer, size_t buflen, uint8_t blockflag)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Receive DataLink packet header.  <a href="#9965316177619f3588cdd22b78899bd1"></a><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Network communication routines for DataLink<p>
<dl class="author" compact><dt><b>Author:</b></dt><dd>Chad Trabant, IRIS Data Management Center</dd></dl>
Version: 2008.196 <hr><h2>Function Documentation</h2>
<a class="anchor" name="8c10ccc5784a65e6efa88e9e80746a82"></a><!-- doxytag: member="network.c::dl_connect" ref="8c10ccc5784a65e6efa88e9e80746a82" args="(DLCP *dlconn)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dl_connect           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d9/d9a/struct_d_l_c_p.html">DLCP</a> *&nbsp;</td>
          <td class="paramname"> <em>dlconn</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Connect to a DataLink server. 
<p>
Open a network socket connection to a Datalink server and set 'dlconn-&gt;link' to the new descriptor. Expects 'dlconn-&gt;addr' to be in 'host:port' format. Either the host, port or both are optional, if the host is not specified 'localhost' is assumed, if the port is not specified '16000' is assumed, if neither is specified (only a colon) then 'localhost' and port '16000' are assumed.<p>
If a permanent error is detected (invalid port specified) the dlconn-&gt;terminate flag will be set so the <a class="el" href="../../d5/d5f/connection_8c.html#ccca46f231c23fd495bb6d5725e97957" title="Collect packets streaming from the DataLink server.">dl_collect()</a> family of routines will not continue trying to connect.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dlconn</em>&nbsp;</td><td>DataLink Connection Parameters</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>the socket descriptor created. </dd></dl>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on errors </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="5b31313fabb3c66918276e87695dec16"></a><!-- doxytag: member="network.c::dl_disconnect" ref="5b31313fabb3c66918276e87695dec16" args="(DLCP *dlconn)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dl_disconnect           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d9/d9a/struct_d_l_c_p.html">DLCP</a> *&nbsp;</td>
          <td class="paramname"> <em>dlconn</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Disconnect a DataLink connection. 
<p>
Close the network socket associated with connection and set 'dlconn-&gt;link' to -1.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dlconn</em>&nbsp;</td><td>DataLink Connection Parameters </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="a38aa90808beee57585044aab4c8e817"></a><!-- doxytag: member="network.c::dl_recvdata" ref="a38aa90808beee57585044aab4c8e817" args="(DLCP *dlconn, void *buffer, size_t readlen, uint8_t blockflag)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dl_recvdata           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d9/d9a/struct_d_l_c_p.html">DLCP</a> *&nbsp;</td>
          <td class="paramname"> <em>dlconn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>readlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&nbsp;</td>
          <td class="paramname"> <em>blockflag</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Receive arbitrary data from a DataLink server. 
<p>
This fundamental routine is used by other library routines to receive data from a DataLink server. Up to <em>readlen</em> bytes of received data is placed into <em>buffer</em>.<p>
If <em>blockflag</em> is true (1) this function will block until <em>readlen</em> bytes have been read. If <em>blockflag</em> is false (0) and no data is available for reading this function will immediately return. If <em>blockflag</em> is false and some initial data is received the function will block until <em>readlen</em> bytes have been read.<p>
If a user specified network I/O timeout was not applied at the system socket level this routine will implement the timeout using an alarm timer to interrupt the blocked send.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dlconn</em>&nbsp;</td><td>DataLink Connection Parameters </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>buffer</em>&nbsp;</td><td>Buffer for received data </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>readlen</em>&nbsp;</td><td>Number of bytes to read and place into <em>buffer</em> </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>blockflag</em>&nbsp;</td><td>Flag to control use of blocking versus non-blocking mode</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>number of bytes read on success </dd></dl>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>when no data available on non-blocking socket </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on connection shutdown </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-2</em>&nbsp;</td><td>on error. </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="9965316177619f3588cdd22b78899bd1"></a><!-- doxytag: member="network.c::dl_recvheader" ref="9965316177619f3588cdd22b78899bd1" args="(DLCP *dlconn, void *buffer, size_t buflen, uint8_t blockflag)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dl_recvheader           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d9/d9a/struct_d_l_c_p.html">DLCP</a> *&nbsp;</td>
          <td class="paramname"> <em>dlconn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>buflen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&nbsp;</td>
          <td class="paramname"> <em>blockflag</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Receive DataLink packet header. 
<p>
Receive a DataLink packet header and place it into <em>buffer</em> up to <em>buflen</em> bytes in length.<p>
The header body returned in <em>buffer</em> will always be NULL terminated. The buffer must be at least 255 bytes in size. The maximum header length is effectively 254 bytes.<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>number of bytes read on success </dd></dl>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>when no data available on non-blocking socket </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on connection shutdown </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-2</em>&nbsp;</td><td>on error. </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="3bdb00c1cd5ecdbd464ee9012fa80f6d"></a><!-- doxytag: member="network.c::dl_senddata" ref="3bdb00c1cd5ecdbd464ee9012fa80f6d" args="(DLCP *dlconn, void *buffer, size_t sendlen)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dl_senddata           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d9/d9a/struct_d_l_c_p.html">DLCP</a> *&nbsp;</td>
          <td class="paramname"> <em>dlconn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>buffer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>sendlen</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Send arbitrary data to a DataLink server. 
<p>
This fundamental routine is used by other library routines to send data via a DataLink connection. Before data is sent the socket to set to blocking mode and back to non-blocking before returning unless there was an error in which case the socket should be disconnected.<p>
If a user specified network I/O timeout was not applied at the system socket level this routine will implement the timeout using an alarm timer to interrupt the blocked send.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dlconn</em>&nbsp;</td><td>DataLink Connection Parameters </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>buffer</em>&nbsp;</td><td>Buffer containing data to send </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>sendlen</em>&nbsp;</td><td>Number of bytes to send from buffer</td></tr>
  </table>
</dl>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on error. </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="15eee68e254a3fc494acfd51ae623c70"></a><!-- doxytag: member="network.c::dl_sendpacket" ref="15eee68e254a3fc494acfd51ae623c70" args="(DLCP *dlconn, void *headerbuf, size_t headerlen, void *databuf, size_t datalen, void *respbuf, int resplen)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int dl_sendpacket           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="../../d9/d9a/struct_d_l_c_p.html">DLCP</a> *&nbsp;</td>
          <td class="paramname"> <em>dlconn</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>headerbuf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>headerlen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>databuf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>datalen</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>respbuf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>resplen</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Create and send a DataLink packet. 
<p>
Send a DataLink packet created by combining an appropriate preheader with <em>headerbuf</em> and, optionally, <em>databuf</em>.<p>
The header length must be larger than 0 but the packet length can be 0 resulting in a header-only packet, commonly used for sending commands.<p>
If the response buffer <em>respbuf</em> is not NULL then read up to <em>resplen</em> bytes into <em>respbuf</em> using <a class="el" href="../../d3/d41/libdali_8h.html#9965316177619f3588cdd22b78899bd1" title="Receive DataLink packet header.">dl_recvheader()</a> after sending the packet. This is only designed for small pieces of data, specifically the server acknowledgement to a command, which are a header-only packets.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>dlconn</em>&nbsp;</td><td>DataLink Connection Parameters </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>headerbuf</em>&nbsp;</td><td>Buffer containing DataLink packet header </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>headerlen</em>&nbsp;</td><td>Length of header buffer to send </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>databuf</em>&nbsp;</td><td>Buffer containing DataLink packet data </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>datalen</em>&nbsp;</td><td>Length of data buffer to send </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>respbuf</em>&nbsp;</td><td>Buffer to place response from server </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>resplen</em>&nbsp;</td><td>Length of response buffer</td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>number of bytes of response received </dd></dl>
<dl compact><dt><b>Return values:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>0</em>&nbsp;</td><td>on success and <em>respbuf</em> is NULL </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>-1</em>&nbsp;</td><td>on error </td></tr>
  </table>
</dl>

</div>
</div><p>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Fri Sep 12 15:38:53 2008 for libdali by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="../../doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
